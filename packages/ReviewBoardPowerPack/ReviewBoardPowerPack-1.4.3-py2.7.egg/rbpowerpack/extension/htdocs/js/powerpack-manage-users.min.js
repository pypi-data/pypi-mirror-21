(function(){$(document).ready(function(){var $checkboxes=$("#powerpack_users input[type=checkbox]"),$removeBtn=$("#powerpack_remove_users"),lastChecked;$("#id_users").rbautocomplete({url:SITE_ROOT+"api/users/",matchCase:false,multiple:true,width:350,extraParams:{fullname:1},parse:function(data){var items=data.users,itemsLen=items.length,parsed=[],value,i;for(i=0;i<itemsLen;i++){value=items[i];parsed.push({data:value,value:value.username,result:value.username})}return parsed},formatItem:function(data){var s=data.username;if(data.fullname){s+=" <span>("+_.escape(data.fullname)+")</span>"}return s},cmp:function(term,a,b){var aUsername=a.data.username,bUsername=b.data.username,aFullname=a.data.fullname,bFullname=a.data.fullname;if(aUsername.indexOf(term)===0){if(bUsername.indexOf(term)===0){return aUsername.localeCompare(bUsername)}return-1}else if(bUsername.indexOf(term)===0){return 1}else{return aFullname.localeCompare(bFullname)}},error:function(xhr){var text;try{text=$.parseJSON(xhr.responseText).err.msg}catch(e){text="HTTP "+xhr.status+" "+xhr.statusText}alert(text)}}).on("autocompleteshow",function(){var $resultsPane=$(".ui-autocomplete-results:not("+":has(.ui-autocomplete-footer))");if($resultsPane.length>0){$("<div/>").addClass("ui-autocomplete-footer").text(gettext("Press Tab to auto-complete.")).appendTo($resultsPane)}});$checkboxes.on({change:function(){var checkedCount=$checkboxes.filter(":checked").length;$removeBtn.prop("disabled",checkedCount===0)},click:function(evt){var $rangedCheckboxes,start,end;if(lastChecked&&evt.shiftKey){start=$checkboxes.index(this);end=$checkboxes.index(lastChecked);$rangedCheckboxes=$checkboxes.slice(Math.min(start,end),Math.max(start,end)+1);$rangedCheckboxes.prop("checked",lastChecked.checked)}lastChecked=this}})})}).call(this);