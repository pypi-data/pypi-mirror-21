(function(){window.PowerPack=window.PowerPack||{};PowerPack.PDF={};PowerPack.PDF.PDF=Backbone.Model.extend({defaults:{pdfURL:"",pdfDocument:null,outlineMap:null},initialize:function(){var self=this,url=this.get("pdfURL");PDFJS.getDocument(url).then(function(pdfDocument){self.set("pdfDocument",pdfDocument);self._initializeNavigationMap(pdfDocument)})},getPage:function(pageNum){var promise=new Promise(_.bind(function(resolve,reject){var pdfDocument=this.get("pdfDocument");if(pdfDocument!==null){this._getPage(pdfDocument,pageNum,resolve)}else{this.once("change:pdfDocument",function(model,pdfDocument){this._getPage(pdfDocument,pageNum,resolve)})}},this));return promise},_getPage:function(pdfDocument,pageNum,resolve){pdfDocument.getPage(pageNum).then(function(page){resolve(page)})},_initializeNavigationMap:function(pdf){var self=this,numPages=pdf.pdfInfo.numPages,pagePromises=[],allPagesPromise,destinationsPromise,outlinePromise,i;for(i=1;i<=numPages;i++){pagePromises.push(pdf.getPage(i))}allPagesPromise=Promise.all(pagePromises);allPagesPromise.then(function(pages){var ref;console.assert(pages.length===numPages);self._pageMap={};for(i=0;i<numPages;i++){ref=pages[i].pageInfo.ref.gen+"@"+pages[i].pageInfo.ref.num;self._pageMap[ref]=i+1}});outlinePromise=pdf.getOutline();destinationsPromise=pdf.getDestinations();Promise.all([allPagesPromise,destinationsPromise,outlinePromise]).then(function(p){var destinations=p[1],outline=p[2];function buildOL(items){var values=[],i,len,ref,destID,destination;for(i=0,len=items.length;i<len;i++){destID=items[i].dest;if(destID===undefined){console.warn("Could not find destination for outline item "+items[i].title);continue}else if(destinations[destID]!==undefined){destination=destinations[destID]}else if(destID instanceof Object){destination=destID}if(destination===undefined){console.warn("Could not find destination for outline item "+items[i].title);continue}ref=destination[0].gen+"@"+destination[0].num;values.push({title:items[i].title,page:self._pageMap[ref],children:buildOL(items[i].items)})}return values}outline=outline&&buildOL(outline)||[];self.set("outlineMap",outline)})}});PowerPack.PDF.Outline=Backbone.Model.extend({defaults:_.defaults({outline:null})});PowerPack.PDF.RegionCommentBlock=RB.RegionCommentBlock.extend({defaults:_.defaults({page:null,scale:null,thumbnailData:null},RB.RegionCommentBlock.prototype.defaults),serializedFields:RB.RegionCommentBlock.prototype.serializedFields.concat(["page","thumbnailData"]),parse:function(fields){fields=RB.RegionCommentBlock.prototype.parse.call(this,fields);fields.page=parseInt(fields.page,10)||undefined;return fields}});PowerPack.PDF.Reviewable=RB.FileAttachmentReviewable.extend({defaults:_.defaults({commentBlockViews:[],currentPage:null,isRB17:false,numPages:null,pdf:null,scale:1,showSidebar:false},RB.FileAttachmentReviewable.prototype.defaults),commentBlockModel:PowerPack.PDF.RegionCommentBlock,initialize:function(attributes,options){var pdf=attributes.pdf;RB.FileAttachmentReviewable.prototype.initialize.call(this,attributes,options);pdf.on("change:pdfDocument",this._onDocumentChanged,this);this._onDocumentChanged(pdf,pdf.get("pdfDocument"))},_onDocumentChanged:function(pdf,pdfDocument){if(pdfDocument!==null){this.set({numPages:pdfDocument.pdfInfo.numPages,currentPage:1})}}});(function(){var OutlineEntryModel,OutlineEntryCollection,OutlineEntryView;OutlineEntryModel=Backbone.Model.extend({defaults:_.defaults({children:null,text:"",page:null}),initialize:function(attributes,options){var item=options.item,destID,destination;this.set({text:item.title,page:item.page});if(item.children.length>0){this.set("children",new OutlineEntryCollection([],{items:item.children}))}}});OutlineEntryCollection=Backbone.Collection.extend({model:OutlineEntryModel,initialize:function(models,options){var items=options.items,item,i,len;for(i=0,len=items.length;i<len;i++){models.push(new OutlineEntryModel({},{item:items[i]}))}Backbone.Collection.prototype.initialize.call(this,models,options)}});OutlineEntryView=Backbone.View.extend({tagName:"li",initialize:function(){var children=this.model.get("children");if(children!==null){this._childViews=_.map(children.models,function(child){return new OutlineEntryView({model:child})})}},render:function(){this._$disclosure=$("<div/>").addClass("disclosure").appendTo(this.el).click(_.bind(this._toggleDisclosure,this));this._disclosed=false;$("<div/>").addClass("page-link").text(this.model.get("text")).data("page",this.model.get("page")).appendTo(this.el);if(this.model.get("children")!==null){this._$ul=$("<ul/>").appendTo(this.el);_.each(this._childViews,function(view){this._$ul.append(view.render().el)},this);this._$disclosure.css("visibility","visible");this._toggleDisclosure()}return this},_toggleDisclosure:function(){if(this._$disclosure!==undefined){if(this._disclosed){this._disclosed=false;this._$disclosure.text("▶");this._$ul.hide()}else{this._disclosed=true;this._$disclosure.text("▼");this._$ul.show()}}}});PowerPack.PDF.OutlineView=Backbone.View.extend({tagName:"ul",events:{"click .page-link":"_onItemClicked"},initialize:function(){this._collection=new OutlineEntryCollection([],{items:this.model.get("outline")});this._childViews=_.map(this._collection.models,function(child){return new OutlineEntryView({model:child})})},render:function(){_.each(this._childViews,function(view){this.$el.append(view.render().el)},this);return this},_onItemClicked:function(ev){var page=$(ev.target).data("page");if(page!==null){this.trigger("selectPage",page)}}})})();PowerPack.PDF.RegionCommentBlockView=RB.RegionCommentBlockView.extend({initialize:function(){RB.RegionCommentBlockView.prototype.initialize.call(this);this.model.on("change:scale",this._updateDimensions,this)},_updateDimensions:function(){var model=this.model,scale=model.get("scale");this.$el.move(model.get("x")*scale,model.get("y")*scale,"absolute").width(model.get("width")*scale).height(model.get("height")*scale)}});PowerPack.PDF.ReviewableView=RB.FileAttachmentReviewableView.extend({className:"pdf-review-ui",commentBlockView:PowerPack.PDF.RegionCommentBlockView,template:_.template(['<div class="pdf-controls">',' <div class="controls-left">','  <div class="powerpack-pdf-icon powerpack-pdf-icon-toggle-sidebar toggle-sidebar" />'," </div>",' <div class="controls-sidebar">','  <div class="powerpack-pdf-icon powerpack-pdf-icon-sidebar-mode-outline sidebar-mode-outline" />','  <div class="powerpack-pdf-icon powerpack-pdf-icon-sidebar-mode-pages sidebar-mode-pages" />','  <div class="powerpack-pdf-icon powerpack-pdf-icon-sidebar-mode-comments sidebar-mode-comments" />'," </div>",' <div class="controls-center-outer">','  <div class="controls-center-inner">','   <div class="page-controls">','    Page:<input type="number" class="pdf-page-curr" /><span class="pdf-page-total" />',"   </div>",'   <div class="powerpack-pdf-icon powerpack-pdf-icon-page-prev page-prev" />','   <div class="powerpack-pdf-icon powerpack-pdf-icon-page-next page-next" />',"  </div>"," </div>",' <div class="controls-right">','   <div class="powerpack-pdf-icon powerpack-pdf-icon-zoom-out zoom-out" />','   <div class="powerpack-pdf-icon powerpack-pdf-icon-zoom-in zoom-in" />'," </div>","</div>",'<div class="pdf-lower">',' <div class="pdf-nav">','  <div class="pdf-nav-outline" />','  <div class="pdf-nav-pages" />','  <div class="pdf-nav-comments">There are no comments.</div>'," </div>",' <div class="pdf-offset">','  <div class="pdf-outer">','   <div class="pdf-inner">',"   </div>","  </div>"," </div>","</div>"].join("")),events:{"mousedown .selection-container":"_onMouseDown",mouseup:"_onMouseUp",mousemove:"_onMouseMove","mouseenter .pdf-page":"_showSelectionArea","mouseleave .pdf-page":"_hideSelectionArea","change .pdf-page-curr":"_selectPage","click .toggle-sidebar":"_toggleSidebar","click .page-prev":"_prevPage","click .page-next":"_nextPage","click .zoom-out":"_zoomOut","click .zoom-in":"_zoomIn","click .pdf-nav .item":"_selectPage"},initialize:function(options){RB.AbstractReviewableView.prototype.initialize.apply(this,options);this._activeSelection=null;this._renderBusy=false;this.model.on("change:scale",this._changeZoom,this);this.model.on("change:numPages",function(){var numPages=this.model.get("numPages");this._controls.$totalPages.text("of "+numPages);this._controls.$currentPage.attr({min:1,max:numPages})},this);this.model.on("change:currentPage",function(){this._controls.$currentPage.val(this.model.get("currentPage"))},this);this._$window=$(window);this._$window.resize(_.bind(this._onWindowResize,this));this.on("commentBlockViewAdded",function(commentBlockView){var pageNum,$selectionContainer;if(this._pages.length>0){pageNum=commentBlockView.model.get("page");console.assert(pageNum<=this._pages.length);$selectionContainer=this._pages[pageNum-1].selectionContainer;$selectionContainer.append(commentBlockView.$el);if("setSelectionRegionSizeFunc"in commentBlockView){commentBlockView.setSelectionRegionSizeFunc(_.bind(this.getSelectionRegionSize,this,$selectionContainer))}}commentBlockView.model.set("scale",this.model.get("scale"));this.model.get("commentBlockViews").push(commentBlockView);commentBlockView.on("remove",function(){var viewsList=this.model.get("commentBlockViews");viewsList=_.without(viewsList,commentBlockView)},this)},this)},renderContent:function(){var self=this,pdf=this.model.get("pdf"),$document=$(document);this.$el.html(this.template());this._controls={$container:this.$(".pdf-controls"),$currentPage:this.$(".pdf-page-curr").prop("disabled",true),$totalPages:this.$(".pdf-page-total"),$toggleSidebar:this.$(".toggle-sidebar"),$sidebarModeOutline:this.$(".sidebar-mode-outline").click(_.bind(this._selectSidebarMode,this,"outline")),$sidebarModePages:this.$(".sidebar-mode-pages").click(_.bind(this._selectSidebarMode,this,"pages")),$sidebarModeComments:this.$(".sidebar-mode-comments").click(_.bind(this._selectSidebarMode,this,"comments"))};this._structure={$lower:this.$(".pdf-lower"),$offset:this.$(".pdf-offset").scroll(_.bind(this._onScroll,this)),$inner:this.$(".pdf-inner"),$sidebarControls:this.$(".controls-sidebar"),$sidebar:this.$(".pdf-nav"),$sidebarOutline:this.$(".pdf-nav-outline"),$sidebarPages:this.$(".pdf-nav-pages"),$sidebarComments:this.$(".pdf-nav-comments")};this._onWindowResize();this._pages=[];pdf.on("change:pdfDocument",this._renderDocument,this);pdf.on("change:outlineMap",this._renderSidebar,this);this._renderDocument(pdf,pdf.get("pdfDocument"));this._renderSidebar(pdf,pdf.get("outlineMap"));this._$window.scroll(function(){var scrollHeight=self._$window.scrollTop()+self._$window.height();self._structure.$offset.css("overflow",scrollHeight+1>=$document.height()?"scroll":"hidden")});return this},_renderDocument:function(pdf,pdfDocument){var $canvas,$pageContent,$selectionContainer,$selectionRect,commentViews,i,numPages,pixelRatio,scale;if(pdfDocument===null){return}numPages=pdfDocument.pdfInfo.numPages;pixelRatio=window.devicePixelRatio;scale=this.model.get("scale");for(i=0;i<numPages;i++){$pageContent=$("<div/>").addClass("pdf-page").data("pageIx",i).attr("id","pdf-page-"+(i+1));$selectionContainer=$("<div/>").addClass("selection-container").proxyTouchEvents().hide().appendTo($pageContent);$selectionRect=$("<div/>").addClass("selection-rect").proxyTouchEvents().hide().appendTo($selectionContainer);$canvas=$("<canvas/>").addClass("pdf-canvas").appendTo($pageContent);this._structure.$inner.append($pageContent);this._pages.push({container:$pageContent,canvas:$canvas,selectionContainer:$selectionContainer,rendered:false})}this.model.get("pdf").getPage(1).then(_.bind(function(pdfPage){var viewport=pdfPage.getViewport(scale*pixelRatio),htmlDimensions={width:viewport.width/pixelRatio+"px",height:viewport.height/pixelRatio+"px"},pageNum;_.each(this._pages,function(page){page.canvas.attr({width:viewport.width,height:viewport.height}).css(htmlDimensions);page.selectionContainer.css(htmlDimensions);page.container.css(htmlDimensions)});if(location.hash&&location.hash.slice(0,6)==="#page-"){pageNum=Number(location.hash.slice(6));if(pageNum>=1&&pageNum<=this.model.get("numPages")){this._jumpToPage(pageNum)}}},this));commentViews=this.model.get("commentBlockViews");_.each(commentViews,_.bind(function(view){var pageNum=view.model.get("page"),$selectionContainer;console.assert(pageNum<=numPages);$selectionContainer=this._pages[pageNum-1].selectionContainer;$selectionContainer.append(view.$el);if("setSelectionRegionSizeFunc"in view){view.setSelectionRegionSizeFunc(_.bind(this.getSelectionRegionSize,this,$selectionContainer))}},this));this._controls.$currentPage.removeProp("disabled");this._renderHighestPriorityPage()},getSelectionRegionSize:function($selectionContainer){var offset=$selectionContainer.position();offset.left+=$selectionContainer.getExtents("m","l");return{left:offset.left,top:offset.top,width:$selectionContainer.width(),height:$selectionContainer.height()}},_renderHighestPriorityPage:function(){var i,visible,highestPriorityPageIx;if(this._renderBusy){return}visible=this._getVisiblePages();i=_.find(visible,function(item){return!item.page.rendered});if(i!==undefined){highestPriorityPageIx=i.index}if(highestPriorityPageIx===undefined&&visible.length>0){i=visible[0].index-1;if(i>=0&&!this._pages[i].rendered){highestPriorityPageIx=i}i=visible[visible.length-1].index+1;if(highestPriorityPageIx===undefined&&i<this._pages.length&&!this._pages[i].rendered){highestPriorityPageIx=visible[visible.length-1].index+1}}if(highestPriorityPageIx!==undefined){this._renderPage(highestPriorityPageIx+1,{success:_.bind(function(){setTimeout(_.bind(this._renderHighestPriorityPage,this))},this)})}},_selectSidebarMode:function(mode){if(mode==="outline"){this._structure.$sidebarOutline.show();this._controls.$sidebarModeOutline.addClass("powerpack-pdf-icon-sidebar-mode-outline-active").removeClass("powerpack-pdf-icon-sidebar-mode-outline")}else{this._structure.$sidebarOutline.hide();this._controls.$sidebarModeOutline.removeClass("powerpack-pdf-icon-sidebar-mode-outline-active").addClass("powerpack-pdf-icon-sidebar-mode-outline")}if(mode==="pages"){this._structure.$sidebarPages.show();this._controls.$sidebarModePages.addClass("powerpack-pdf-icon-sidebar-mode-pages-active").removeClass("powerpack-pdf-icon-sidebar-mode-pages")}else{this._structure.$sidebarPages.hide();this._controls.$sidebarModePages.removeClass("powerpack-pdf-icon-sidebar-mode-pages-active").addClass("powerpack-pdf-icon-sidebar-mode-pages")}if(mode==="comments"){this._structure.$sidebarComments.show();this._controls.$sidebarModeComments.addClass("powerpack-pdf-icon-sidebar-mode-comments-active").removeClass("powerpack-pdf-icon-sidebar-mode-comments")}else{this._structure.$sidebarComments.hide();this._controls.$sidebarModeComments.removeClass("powerpack-pdf-icon-sidebar-mode-comments-active").addClass("powerpack-pdf-icon-sidebar-mode-comments")}},_renderSidebar:function(pdf,outline){var $pages,i,logBase=Math.log(10),numPages=this.model.get("numPages"),pageClass,view;if(outline===null){return}if(outline&&outline.length){view=new PowerPack.PDF.OutlineView({model:new PowerPack.PDF.Outline({outline:outline})});view.on("selectPage",function(page){this._jumpToPage(page)},this);$("<div/>").append(view.render().el).appendTo(this._structure.$sidebarOutline);this._selectSidebarMode("outline")}else{this._controls.$sidebarModeOutline.css("visibility","hidden");this._selectSidebarMode("pages");this._controls.$sidebarModePages.css("visibility","hidden")}$pages=$("<div/>").addClass("page-mocks");for(i=1;i<=numPages;i++){pageClass="page-digits-"+Math.floor(Math.log(i)/logBase+1);$("<div/>").addClass("item page-mock "+pageClass).text(i).data("page",i).appendTo($pages)}this._structure.$sidebarPages.append($pages);this._controls.$sidebarModeComments.hide();this.$(".controls-sidebar").css("left","200px")},_onWindowResize:function(){var outerHeight=this._$window.height();if(this.model.get("isRB17")){outerHeight-=20}else{outerHeight-=$(".review-request-header").outerHeight()+$("#page-container").getExtents("p","b")*2}this.$el.height(outerHeight);this._structure.$lower.height(outerHeight-29)},_getVisiblePages:function(){var offsetEl=this._structure.$offset[0],scrollTop=offsetEl.scrollTop,scrollHeight=offsetEl.clientHeight,scrollBottom=scrollTop+scrollHeight,page,pageEl,pageTop,pageHeight,pageBottom,overlapTop,overlapBottom,visible=[],i;for(i=0;i<this._pages.length;i++){page=this._pages[i];pageEl=page.container[0];pageTop=pageEl.offsetTop+12;pageHeight=pageEl.offsetHeight;pageBottom=pageTop+pageHeight;if(pageBottom<scrollTop){continue}if(pageTop>scrollBottom){break}visible.push({page:page,index:i})}return visible},_onScroll:function(ev){var offsetEl=this._structure.$offset[0],scrollTop=offsetEl.scrollTop,scrollHeight=offsetEl.clientHeight,scrollBottom=scrollTop+scrollHeight,i,page,pageEl,pageTop,pageHeight,pageBottom,overlapTop,overlapBottom,biggestPageIx=-1,biggestPageSize=0;for(i=0;i<this._pages.length;i++){page=this._pages[i];pageEl=page.container[0];pageTop=pageEl.offsetTop+12;pageHeight=pageEl.offsetHeight;pageBottom=pageTop+pageHeight;if(pageTop>scrollBottom||pageBottom<scrollTop){continue}overlapTop=Math.max(pageTop,scrollTop);overlapBottom=Math.min(pageBottom,scrollBottom);overlapSize=overlapBottom-overlapTop;if(overlapSize>biggestPageSize){biggestPageSize=overlapSize;biggestPageIx=i}}console.assert(biggestPageIx>=0);this.model.set("currentPage",biggestPageIx+1);this._renderHighestPriorityPage()},_jumpToPage:function(pageNum){console.assert(pageNum>=1);console.assert(pageNum<=this._pages.length);this._structure.$offset.scrollTop(this._pages[pageNum-1].container.position().top+12)},_renderPage:function(pageNum,options){var self=this,page=this._pages[pageNum-1];options=options||{};if(page.rendered){if(_.isFunction(options.success)){options.success()}return}this._renderBusy=true;this.model.get("pdf").getPage(pageNum).then(function(pdfPage){var pixelRatio=window.devicePixelRatio,viewport=pdfPage.getViewport(self.model.get("scale")*pixelRatio),animationSpeed=100,htmlDimensions={width:viewport.width/pixelRatio+"px",height:viewport.height/pixelRatio+"px"};page.canvas.attr({width:viewport.width,height:viewport.height}).animate(htmlDimensions,animationSpeed);page.selectionContainer.css(htmlDimensions);page.container.animate(htmlDimensions,animationSpeed);page.rendered=true;pdfPage.render({canvasContext:page.canvas[0].getContext("2d"),viewport:viewport}).promise.then(function renderDone(){self._renderBusy=false;if(_.isFunction(options.success)){options.success()}},function renderError(error){console.warning("Error while rendering pdf: "+error);self._renderBusy=false;page.rendered=false;if(_.isFunction(options.error)){options.error(error)}})})},_isCommentDialogVisible:function(){var $commentDlg;if(!this.commentDlg){return false}$commentDlg=this.commentDlg.jquery?this.commentDlg:this.commentDlg.$el;return!$commentDlg.is(":hidden")},_onMouseDown:function(ev){var $target=$(ev.target),$page=$target.parents(".pdf-page"),$selectionRect=$page.find(".selection-rect"),offset;if(ev.which===1&&!this._isCommentDialogVisible()&&!$target.hasClass("selection-flag")){offset=$page.offset();this._activeSelection={beginX:ev.pageX-Math.floor(offset.left)-1,beginY:ev.pageY-Math.floor(offset.top)-1,$page:$page,$selectionRect:$selectionRect};$selectionRect.move(this._activeSelection.beginX,this._activeSelection.beginY).width(1).height(1).show();if($selectionRect.is(":hidden")){if(this.commentDlg.jquery){this.commentDlg.hide()}else{this.commentDlg.close()}}return false}},_onMouseUp:function(ev){var $selectionRect,pageIx,width,height,offset,context,pixelRatio,x,y,sourceWidth,sourceHeight,imageData,tempCanvas,scale=this.model.get("scale"),SELECTION_CLICK_EPSILON=5;if(!this._activeSelection){return true}$selectionRect=this._activeSelection.$selectionRect;pageIx=this._activeSelection.$page.data("pageIx");if(!this._isCommentDialogVisible()&&$selectionRect.is(":visible")){width=$selectionRect.width();height=$selectionRect.height();offset=$selectionRect.position();ev.stopPropagation();$selectionRect.hide();this._activeSelection=null;if(width>SELECTION_CLICK_EPSILON&&height>SELECTION_CLICK_EPSILON){context=this._pages[pageIx].canvas[0].getContext("2d");pixelRatio=window.devicePixelRatio;x=Math.floor(offset.left*pixelRatio);y=Math.floor(offset.top*pixelRatio);sourceWidth=Math.floor(width*pixelRatio);sourceHeight=Math.floor(height*pixelRatio);imageData=context.getImageData(x,y,sourceWidth,sourceHeight);tempCanvas=$("<canvas>").attr({width:sourceWidth,height:sourceHeight})[0];tempCanvas.getContext("2d").putImageData(imageData,0,0);this.createAndEditCommentBlock({x:Math.floor(offset.left/scale),y:Math.floor(offset.top/scale),width:Math.round(width/scale),height:Math.round(height/scale),page:pageIx+1,thumbnailData:tempCanvas.toDataURL()})}}},_onMouseMove:function(ev){var offset,$page,$selectionRect,pageX,pageY,pageWidth,pageHeight,x,y;if(!this._activeSelection){return true}$page=this._activeSelection.$page;$selectionRect=this._activeSelection.$selectionRect;if(!this._isCommentDialogVisible()&&$selectionRect.is(":visible")){offset=$page.offset();pageX=Math.floor(offset.left)-1;pageY=Math.floor(offset.top)-1;pageWidth=Math.floor($page.innerWidth());pageHeight=Math.floor($page.innerHeight());x=Math.min(Math.max(ev.pageX-pageX,0),pageWidth-2);y=Math.min(Math.max(ev.pageY-pageY,0),pageHeight-2);$selectionRect.css(this._activeSelection.beginX<=x?{left:this._activeSelection.beginX,width:x-this._activeSelection.beginX}:{left:x,width:this._activeSelection.beginX-x}).css(this._activeSelection.beginY<=y?{top:this._activeSelection.beginY,height:y-this._activeSelection.beginY}:{top:y,height:this._activeSelection.beginY-y});return false}},_prevPage:function(){var page=this.model.get("currentPage");if(page>1){this._jumpToPage(page-1)}},_nextPage:function(){var page=this.model.get("currentPage");if(page<this.model.get("numPages")){this._jumpToPage(page+1)}},_selectPage:function(ev){var $target=$(ev.currentTarget),isInput=$target.hasClass("pdf-page-curr"),page=isInput?$target.val():$target.data("page");if(page>0&&page<=this.model.get("numPages")){this._jumpToPage(page)}else{if(isInput){$target.val(this.model.get("currentPage"))}}},_toggleSidebar:function(){var show=!this.model.get("showSidebar"),animationSpeed=100,self=this;this.model.set("showSidebar",show);if(show){this._structure.$sidebar.show().animate({width:"250px"},animationSpeed);this._structure.$offset.addClass("sidebar-open").animate({"margin-left":"250px"},animationSpeed);this._controls.$toggleSidebar.removeClass("powerpack-pdf-icon-toggle-sidebar").addClass("powerpack-pdf-icon-toggle-sidebar-active");this._structure.$sidebarControls.fadeIn(animationSpeed)}else{this._structure.$sidebar.animate({width:"0px"},{duration:animationSpeed,complete:function(){self._structure.$sidebar.hide();self._structure.$offset.removeClass("sidebar-open")}});this._structure.$offset.animate({"margin-left":"0px"},animationSpeed);this._controls.$toggleSidebar.removeClass("powerpack-pdf-icon-toggle-sidebar-active").addClass("powerpack-pdf-icon-toggle-sidebar");this._structure.$sidebarControls.fadeOut(animationSpeed)}},_showSelectionArea:function(ev){var $page=$(ev.target).parents(".pdf-page");$page.find(".selection-container").show()},_hideSelectionArea:function(ev){var $page=$(ev.target).parents(".pdf-page"),$selectionRect=$page.find(".selection-rect");if($selectionRect.is(":hidden")&&!this._isCommentDialogVisible()){$page.find(".selection-container").hide()}},_changeZoom:function(){var commentViews=this.model.get("commentBlockViews"),scale=this.model.get("scale");_.each(commentViews,function(view){view.model.set("scale",scale)});_.each(this._pages,function(page){page.rendered=false});this._renderHighestPriorityPage()},_zoomIn:function(){this.model.set("scale",this.model.get("scale")*(4/3))},_zoomOut:function(){this.model.set("scale",this.model.get("scale")*(3/4))}})}).call(this);