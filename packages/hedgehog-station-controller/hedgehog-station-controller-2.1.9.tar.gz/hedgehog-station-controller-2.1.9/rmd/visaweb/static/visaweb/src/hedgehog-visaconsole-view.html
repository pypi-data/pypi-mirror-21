<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="shared-styles.html">

<dom-module id="hedgehog-visaconsole-view">
    <template>
        <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }




        </style>

        <app-route route="{{route}}" pattern="/:id" data="{{routeData}}"></app-route>
        <iron-ajax url="/assets/[[routeData.id]]" auto last-response="{{asset}}"></iron-ajax>
        <paper-card style="width: 100%;">
            <div class="card-content">
                <div class="circle">3</div>
                <h1>[[asset.alias]] VISA konzol</h1>

                <p>Kapcsolódva a <b>[[asset.address]]</b> erőforráshoz.</p>

                <paper-radio-group selected="{{commandMode}}">
                    <paper-radio-button name="read">Olvasás</paper-radio-button>
                    <paper-radio-button name="write">Írás</paper-radio-button>
                    <paper-radio-button name="query">Lekérdezés</paper-radio-button>
                </paper-radio-group>


                <form id="currentCommandForm" is="iron-form" method="post" action$="/visa/[[commandMode]]"
                      content-type="application/json">
                    <input type="hidden" name="alias" value="[[asset.alias]]"/>
                    <paper-input name="command" label="Parancs" type="text" placeholder="?IDN">
                        <span prefix style="margin-right: 8px;">[[commandMode]]</span>
                    </paper-input>

                </form>

                <p>Ea duis bonorum nec, falli paulo aliquid ei eum.Has at minim mucius aliquam, est id tempor
                    laoreet.Pro saepe pertinax ei, ad pri animal labores suscipiantur.</p>
            </div>
            <div class="card-actions">
                <paper-button raised on-tap="onSubmitVisa">Küldés</paper-button>
                <paper-button raised on-tap="onSaveCommand">Mentés</paper-button>
            </div>
        </paper-card>
        <hr/>
        <paper-card style="width: 100%;" heading="Kimenet">
            <div class="card-actions">
                <paper-button raised on-tap="onClearConsole">Ürítés</paper-button>
            </div>
            <div class="card-content">
                <template is="dom-repeat" items="{{outputData}}">
                    <p>>> [[timestamp]] {{item.message}}</p>
                </template>
            </div>

        </paper-card>
    </template>

    <script>
    Polymer({
      is: 'hedgehog-visaconsole-view',
      properties: {
        commandMode: {
            type: String,
            notify: true,
            value: 'query'
        },
        outputData: {
            type: Array,
            notify: true,
            value: function() {
              return [];
            }
        }
      },
      observers: [
        'entriesAddedOrRemoved(outputData.splices)'
      ],
      listeners: {
        'iron-form-response': 'onSubmitVisaResponse',
        'iron-form-error': 'onSubmitVisaError'
      },

      entriesAddedOrRemoved: function(changeRecord) {
        if (changeRecord) {
          changeRecord.indexSplices.forEach(function(s) {
            s.removed.forEach(function(user) {
            });
            for (var i=0; i<s.addedCount; i++) {
              var index = s.index + i;
              var newUser = s.object[index];
            }
          }, this);
        }
      },

      onClearConsole: function(event, details) {
        this.set('outputData', []);
      },

      onSaveCommand: function() {
        this.$.currentCommandForm.serialize();
      },

      onSubmitVisa: function(event, details) {
        this.$.currentCommandForm.submit();
        this.push('outputData', {
            timestamp: new Date(),
            message: this.commandMode + ' ' + this.$.currentCommandForm.serialize().command
        });
      },
      onSubmitVisaResponse: function(event, details) {
        this.push('outputData', {
            timestamp: new Date(),
            message: details.response
        });
      },
      onSubmitVisaError: function(event, details) {
        this.push('outputData', {
            timestamp: new Date(),
            level: 'warning',
            message: details.error
        });

      }
    });







    </script>
</dom-module>
