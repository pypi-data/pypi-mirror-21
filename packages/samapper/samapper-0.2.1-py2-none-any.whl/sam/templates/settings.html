$def with (user, settings, datasources, livekeys, importers)
$ disabled = "" if user.may_post() else "disabled"
<div class="ui container">
  <h1 class="ui center aligned header">Settings</h1>

  <!-- Data Sources -->
  $if not disabled:
    <h3 class="ui header">Data Sources</h3>
    <p>Data sources let you store multiple sets of network data</p>
    <p>Each data source stored their own set of connection history and timeline.  Node information, such as tags, environment, and hostnames, is shared across data sources.</p>
    <div class="ui datasources grid">
      <div class="four wide column">
        <div class="ui vertical fluid tabular menu"  id="ds_tabs">
          $if datasources:
            $for ds in datasources:
              <a class="$('active' if ds['id'] == settings['datasource'] else '') item" data-tab="ds$ds['id']"><i class="on square icon"></i><i class="off square outline icon"></i>$ds['name']</a>
          $else:
            <a class="item" data-tab="dsnone"><i class="off square outline icon"></i>None</a>
        </div>
      </div>
      <div id="ds_tab_contents" class="twelve wide stretched column">
        $if datasources:
          $for ds in datasources:
            <div class="ui $('active' if ds['id'] == settings['datasource'] else '') tab segment" data-tab="ds$ds['id']">
              <table class="ui fixed definition table">
                <tbody>
                <tr>
                  <td class="right aligned">Name:</td>
                  <td>
                    <div class="ui transparent left icon $disabled input"><input class="ds_name" data-content="$ds['name']" placeholder="-" type="text" value="$ds['name']"><i class="write icon"></i></div>
                  </td>
                </tr>
                <tr>
                  <td class="right aligned">Auto-refresh (map view):</td>
                  <td>
                    <div class="ui toggle $disabled checkbox">
                      <input class="ds_live" name="public" type="checkbox" $('checked=""' if ds['ar_active'] else '')>
                      <label>&nbsp;</label>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td class="right aligned">Auto-refresh interval (seconds):</td>
                  <td>
                    <div class="ui transparent left icon $disabled input"><input class="ds_interval" data-content="$ds['ar_interval']" placeholder="-" type="text" value="$ds['ar_interval']"><i class="write icon"></i></div>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
        $else:
          <div class="active tab segment" data-tab="dsnone">
            <table class="ui fixed definition table">
              <tbody>
                <tr>
                  <td class="right aligned">...</td>
                  <td>...</td>
                </tr>
              </tbody>
            </table>
          </div>
      </div>
    </div>

    <div class="ui secondary menu">
      <a class="$disabled item" id="add_ds"><i class="blue $disabled add icon"></i>New Data Source</a>
      <div class="item">|</div>
      <a class="$disabled item" id="rm_ds"><i class="red $disabled remove icon"></i>Remove Data Source</a>
      <div class="item">|</div>
      <div class="$disabled ui deletion dropdown item">
        <span class="text">Delete ...</span>
        <div class="menu">
          <a class="$disabled item"><i class="red $disabled trash icon"></i>Delete hostname information</a>
          <a class="$disabled item"><i class="red $disabled trash icon"></i>Delete tag information</a>
          <a class="$disabled item"><i class="red $disabled trash icon"></i>Delete environment information</a>
          <a class="$disabled item"><i class="red $disabled trash icon"></i>Delete connection information</a>
        </div>
      </div>
      <div class="item">|</div>
      <a class="$disabled item" id="upload_log"><i class="blue write icon"></i>Upload log</a>
    </div>

    <!-- Live Updates -->
    <h3 class="ui header">Live Updates</h3>
    <p>Live updates are a way to connect your router or gateway directly to the database.</p>
    <p>To enable this, you need to run a collector on your local network which will translate network data and open a secure connection to our cloud server.</p>
    <p>The live collector needs to be configured to point at our server and when you run it, you need to supply an access key, and what format to expect.</p>
    <p>Live collector access keys grant access to upload network data (syslog lines) directly into your database.</p>
    <div class="field">
      <table class="ui compact celled collapsing table">
        <thead>
          <tr>
            <th>Remove</th>
            <th>Access Key</th>
            <th>Destination</th>
          </tr>
        </thead>
        <tbody id="live_update_tbody">
          $for lk in livekeys:
            <tr>
              <td class="collapsing">
                <button class="remove_live_key $disabled ui small icon button">
                  <i class="red delete icon"></i>
                </button>
              </td>
              <td class="secret key">$lk['access_key']</td>
              <td>$lk['datasource']</td>
            </tr>
          $if not livekeys:
            <tr>
              <td class="collapsing">
                <button class="disabled ui small icon button">
                  <i class="red delete icon"></i>
                </button>
              </td>
              <td colspan="2">none</td>
            </tr>
        </tbody>
        <tfoot class="full-width">
          <tr>
            <th colspan="3">
              <div id="add_live_key" class="ui $disabled small primary labeled icon button">
                <i class="add icon"></i>Generate
              </div>
              <div class="ui selection $disabled dropdown">
                $if datasources:
                  <input id="live_dest" name="live_dest" type="hidden" value="ds$datasources[0]['id']">
                  <i class="dropdown icon"></i>
                  <div class="default text">data source</div>
                  <div class="menu" id="live_dest_list">
                    $for ds in datasources:
                      <div class="item" data-value="ds$ds['id']">$ds['name']</div>
                  </div>
                $else:
                  <input id="live_dest" name="live_dest" type="hidden" value="dsnone">
                  <i class="dropdown icon"></i>
                  <div class="default text">data source</div>
                  <div class="menu" id="live_dest_list">
                    <div class="item" data-value="dsnone">None</div>
                  </div>
              </div>
            </th>
          </tr>
        </tfoot>
      </table>
    </div>

  <!--
  <div class="field">
    <span class="text">** Some way to delete data that is older than X minutes. </span>
    <span class="text">Maybe note the time range represented within the data source? </span>
    <span class="text">Should this be part of the delete menu? (answer: yes)</span>
  </div>
  -->
  <!-- Colors -->
  <!-- <h3 class="ui header">Colors</h3> -->
</div>

<!-- Confirm Delete modal -->
<div id="deleteModal" class="ui small basic modal">
  <i class="close icon"></i>
  <div class="header">
    Confirm Delete
  </div>
  <div class="image content">
    <div class="image">
      <i class="trash outline icon"></i>
    </div>
    <div class="description">
      <p id="deleteMessage">Are you sure?</p>
    </div>
  </div>
  <div class="actions">
    <div class="two fluid ui inverted buttons">
      <div class="ui cancel red basic inverted button">
        <i class="remove icon"></i>
        Cancel
      </div>
      <div class="ui ok green inverted button">
        <i class="checkmark icon"></i>
        Confirm
      </div>
    </div>
  </div>
</div>

<!-- New Datasource modal -->
<div id="newDSModal" class="ui small basic modal">
  <i class="close icon"></i>
  <div class="header">
    New Data Source
  </div>
  <div class="image content">
    <div class="image">
      <i class="cube icon"></i>
    </div>
    <div class="ui form">
      <h4 class="ui inverted header">Please enter a name for your data source:</h4>
      <div class="field">
        <input id="newDSName" type="text" placeholder="Data source 1">
      </div>
    </div>
  </div>
  <div class="actions">
    <div class="two fluid ui inverted buttons">
      <div class="ui cancel red basic inverted button">
        <i class="remove icon"></i>
        Cancel
      </div>
      <div class="ui ok green inverted button">
        <i class="checkmark icon"></i>
        Confirm
      </div>
    </div>
  </div>
</div>

<!-- Upload Log modal -->
<div id="uploadModal" class="ui small basic modal">
  <i class="close icon"></i>
  <div class="header">
    Upload Log
  </div>
  <div class="image content">
    <div class="image">
      <i class="file text outline icon"></i>
    </div>
    <div class="ui inverted transparent form">
      <div class="field">
        <label>Choose a file to upload</label>
        <input id="log_path" type="file" placeholder="<log file>">
      </div>
      <div class="field">
        <label>Log format</label>
        <div class="ui selection dropdown">
          $if importers:
            <input name="log_format" id="log_format" type="hidden" value="$importers[0][0]">
            <i class="dropdown icon"></i>
            <div class="default text">File Format</div>
            <div class="menu">
              $for imp in importers:
                <div class="item" data-value="$imp[0]">$imp[1]</div>
            </div>
          $else:
            <input name="log_format" id="log_format" type="hidden" value="none">
            <i class="dropdown icon"></i>
            <div class="default text">File Format</div>
            <div class="menu">
              <div class="item" data-value="none">None</div>
            </div>
        </div>
      </div>
      <div class="field">
        <label>Data source</label>
        <div class="ui selection dropdown">
          $if datasources:
            <input name="log_ds" id="log_ds" type="hidden" value="ds$datasources[0]['id']">
            <i class="dropdown icon"></i>
            <div class="default text">data source</div>
            <div class="menu" id="log_ds_list">
              $for ds in datasources:
                <div class="item" data-value="ds$ds['id']">$ds['name']</div>
            </div>
          $else:
            <input name="log_ds" id="log_ds" type="hidden" value="dsnone">
            <i class="dropdown icon"></i>
            <div class="default text">data source</div>
            <div class="menu" id="log_ds_list">
              <div class="item" data-value="dsnone">None</div>
            </div>
        </div>
      </div>
    </div>
  </div>
  <div class="actions">
    <div class="two fluid ui inverted buttons">
      <div class="ui cancel red basic inverted button">
        <i class="remove icon"></i>
        Cancel
      </div>
      <div class="ui ok green inverted button">
        <i class="checkmark icon"></i>
        Confirm
      </div>
    </div>
  </div>
</div>

<div class="ui response small basic modal">
  <i class="close icon"></i>
  <div id="upload_results_title" class="header">
    Success
  </div>
  <div class="content">
    <div id="upload_results" class="description">
      Your changes were applied successfully
    </div>
  </div>
  <div class="actions">
    <div class="ui cancel button">OK</div>
  </div>
</div>